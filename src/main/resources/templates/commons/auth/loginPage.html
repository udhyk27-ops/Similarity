<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        main {
            flex-grow: 1;
        }
        .form {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            width: 19rem;
            height: 16rem;
            padding: 0.5rem;
        }
        .form .form-header {
            height: 2rem;
            display: flex;
            align-items: center;
            text-align: center;
        }
        .form .form-header > h3 {
            width: calc(100%);
            color: #414040;
        }
        .form .form-elements {
            margin-top: 1rem;
        }
        .form .form-elements .form-element {
            height: 3rem;
            opacity: 1;
            overflow: hidden;
            transition: all 500ms ease-in-out;
        }
        .form .form-elements input {
            width: 100%;
            padding: 0.6rem;
            font-size: 1rem;
            margin: 0.3rem 0;
            border-radius: 0.7rem;
            box-sizing: border-box;
            border: 1px solid #edc0c0;
            background: #fffdfd;
        }
        .form .form-elements input:focus {
            border: 1px solid #fd4242;
            outline: none;
        }
        .input_chk + label {
            /*color: #414040;*/
            font-size: 0.9rem;
        }
        .form .form-element button {
            width: 100%;
            padding: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 0.6rem;
            border-radius: 0.6rem;
            background: #f1575b;
            color: #f5f5f5;
            cursor: pointer;
            border: none;
            outline: none;
        }
        .form .form-element button:hover {
            background-color: #D33A4C;
            color: white;
        }

    </style>
</head>
<body>
    <main>
        <div class="form signup">
            <div class="form-header">
                <h3>사진공모전 저작물 등록관리 시스템</h3>
            </div>
            <form id="login_frm" th:action="@{/login}" method="post">
                <div class="form-elements">
                    <div class="form-element">
                        <input type="text" id="f_id" name="f_id" placeholder="아이디">
                    </div>
                    <div class="form-element">
                        <input type="password" id="f_pw" name="f_pw" placeholder="패스워드">
                    </div>
                </div>
                <div class="">
                    <input type="checkbox" id="save_id" name="checkbox" class="input_chk">
                    <label for="save_id">아이디 저장</label>
                </div>
                <div class="form-element">
                    <button id="submit-btn">로그인</button>
                </div>
            </form>
        </div>
    </main>
    <th:block th:replace="~{commons/fragments/footerPage.html :: footer}"></th:block>
    <script>
        document.addEventListener("DOMContentLoaded", function() {

            const fId = document.getElementById("f_id");
            const fPw = document.getElementById("f_pw");
            const submitBtn = document.getElementById("submit-btn");
            const saveId = document.getElementById("save_id");

            fId.addEventListener("keydown", function(e) {
                if(e.key === "Enter") {
                    submitBtn.click();
                }
            })
            fPw.addEventListener("keydown", function(e) {
                if(e.key === "Enter") {
                    submitBtn.click();
                }
            })
            submitBtn.addEventListener("click", function(e) {
                console.log("실행1");
                if(!validate.chkEmpty()) {
                    e.preventDefault();
                }
            })

            validate.chkError();

            let key = cookie.getCookie("saveId");
            if(key != "") {
                fId.value = key;
            }
            if(fId.value != "") {
                saveId.checked = true;
            }

            saveId.addEventListener("change", function() {
                if(saveId.checked){
                    cookie.setCookie("saveId", fID.value, 30);
                }else{
                    cookie.deleteCookie("saveId");
                }
            })

            fId.addEventListener("keyup", function() {
                if(saveId.checked){
                    cookie.setCookie("saveId", fId.value, 30);
                }
            })

        });
        const cookie = {
            setCookie: function(name, value, days) {
                let exdate = new Date();
                exdate.setDate(exdate.getDate() + days);
                let cookieVal = encodeURIComponent(value) + ((days == null) ? "" : "; expires=" + exdate.toUTCString());

                document.cookie = name + "=" + cookieVal;
            },
            deleteCookie: function(name) {
                let exdate = new Date();
                exdate.setDate(exdate.getDate() - 1);
                document.cookie = name + "=; expires=" + exdate.toUTCString();
            },
            getCookie: function(name) {
                name = name + '=';
                let cookieData = document.cookie;
                let start = cookieData.indexOf(name);
                let cookieValue = '';

                if(start != -1) {
                    start += name.length;
                    let end = cookieData.indexOf(';', start);
                    if(end == -1) end = cookieData.length;
                    cookieValue = decodeURIComponent(cookieData.substring(start, end));
                }
                return cookieValue;
            }
        }
        const validate = {
            chkEmpty: function() {
                console.log("실행2");
                const id = document.getElementById("f_id").value;
                const pw = document.getElementById("f_pw").value;
                if(id === "") {
                    alert("아이디를 입력해주세요");
                    return false;
                }
                if(pw === ""){
                    alert("패스워드를 입력해주세요");
                    return false;
                }
                return true;
            },
            chkError: function() {
               const urlParams = new URLSearchParams(window.location.search);
               if(urlParams.get('error') === 'true'){
                   alert("로그인에 실패했습니다");
                   window.location.href = "/login";
               }
            }
        }
    </script>
</body>
</html>